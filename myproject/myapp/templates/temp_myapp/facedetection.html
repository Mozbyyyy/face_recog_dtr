{% extends "temp_myapp/base.html" %}
{% load static %}

{% block content %}
{% include 'temp_myapp/navbar.html' %}

<style>
   .toastSize{
    font-size:1.1rem;
    font-weight:bold;
    }
    
    #error-message {
    position: absolute;
    top: 3.4rem;
    left: 0; /* Adjust the left position */
    width: 100%;
    height: 100%;
    display: none;
    background-color: rgba(255, 0, 0, 0.7);
    color: white;
    font-size: 1.1rem;
    text-align: left; /* Align the text to the left */
    padding: 12rem 7rem; /* Adjust padding for better appearance */
    box-sizing: border-box;
    font-weight:bold;
}


</style>


    <link rel="stylesheet" type="text/css" href="{% static 'css/facedetection.css' %}">




    <div class="container">


        <div id="toast-container"></div>

         <div class="video-container">
            <img id="videoElement" width="660" height="490" alt="Real-Time Video Stream">
        </div>





        <div class="table-container">
            <div class="card-body">
                <div class="table-responsive">
                    <table id="defaultdatatable" class="table table-bordered table-hover table-striped tables">
                        <thead>
                            <tr>
                                <th>NAME</th>
                                <th>TIME IN</th>
                                <th>BREAK OUT</th>
                                <th>BREAK IN</th>
                                <th>TIME OUT</th>
                            </tr>
                        </thead>
                        <tbody>
                            {# <div id="attendance-data"></div> #}


                        </tbody>
                    </table>
                </div>
            </div>
        </div>








    </div>







<script>
    
        var video = document.getElementById('videoElement');
        video.src = "{% url 'camera_feed' %}";

        video.onloadedmetadata = function() {
            video.play();
        };






 toastr.options = {
            positionClass: 'toast-top-left',
            preventDuplicates: false,
            progressBar: true,
            showDuration: 1000,
            hideDuration: 800,
            timeOut: 5000,
            extendedTimeOut: 1000,
            messageClass: 'toastSize',
        };


var previousData = [];

function updateAttendance() {
    var currentTime = new Date().getHours();
    $.ajax({
        url: '{% url "get_attendance_data" %}',
        type: 'GET',
        dataType: 'json',
        success: function (data) {
            var tableBody = $('#defaultdatatable tbody');

            // Check if data has been added or updated
            if (!arraysEqual(data.attendances, previousData)) {
                // Determine the type of update (e.g., timein, breakout)
            

                // Customize success message based on the update type
                var message = "Successfully added" 
                toastr.success(message);
            }

            // Clear previous table data
            tableBody.empty();

            data.attendances.forEach(function (attendance) {
                
                var row = $('<tr>');
                row.append('<td>' + attendance.name + '</td>');
                row.append('<td>' + attendance.timein + '</td>');
                row.append('<td>' + attendance.breakout + '</td>');
                row.append('<td>' + attendance.breakin + '</td>');
                row.append('<td>' + attendance.timeout + '</td>');
                tableBody.append(row);
            });

            // Update previousData for the next comparison
            previousData = data.attendances.slice();
        },
        error: function (error) {
            console.error('Error fetching attendance data:', error);
        }
    });
}

// Compare two arrays for equality
function arraysEqual(arr1, arr2) {
    return JSON.stringify(arr1) === JSON.stringify(arr2);
}


setInterval(updateAttendance, 300);



</script>







{% endblock content %}
